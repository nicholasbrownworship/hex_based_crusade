
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ozark Invitational – Family Golf Weekend</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Ryder Cup-style golf tournament at Diamond Hills Country Club in Diamond City, AR. Two days, mixed formats, trophy, and bragging rights." />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Icons / PWA touches -->
  <link rel="icon" href="favicon.ico" />
  <link rel="apple-touch-icon" href="images/icons/apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#244f3c">
  <link rel="preload" as="image" href="images/logo.png" />

  <!-- App script -->
  <script>
    // Ensure the homepage has a players array so script.js doesn't crash
    window.players = window.players || [];
  </script>
  <script src="script.js?v=2" defer></script>

  <!-- Page-scoped CSS (hero, gallery, featured players helpers) -->
  <style>
    body {
      padding-top: 140px; /* room for fixed header */
    }

    /* HERO (video-ready) */
    .hero.video {
      position: relative;
      min-height: 62vh;
      overflow: clip;
      background: radial-gradient(1200px 600px at 10% -10%, #132022 0%, #0b0f0d 45%, #0b0f0d 100%);
    }
    .hero.video .hero-video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: .9;
    }
    .hero.video .hero-overlay {
      position: relative;
      z-index: 1;
      display: grid;
      place-items: start;
      gap: .7rem;
      max-width: 1100px;
      margin: 0 auto;
      padding: 14vh 16px 12vh;
      color: #f5f0e6;
      text-shadow: 0 10px 30px rgba(0,0,0,.55);
    }
    .hero.video h1 {
      margin: 0;
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 900;
      letter-spacing: .02em;
    }
    .hero.video .lead {
      margin: 0;
      opacity: .95;
      max-width: 60ch;
    }
    .hero.video .hero-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .hero.video .pill {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: .4rem .6rem;
      border-radius: 999px;
      background: rgba(0,0,0,.35);
      color: #eaf6f0;
      border: 1px solid rgba(255,255,255,.2);
    }
    .hero.video .pill-label { opacity: .8; font-weight: 600; }
    .hero.video .pill-value { font-weight: 800; letter-spacing: .02em; }
    .hero.video .hero-actions { display: flex; gap: 10px; margin-top: 10px; }
    .hero.video .btn.primary {
      background: #d1a14b;
      color: #1a1407;
      border: 1px solid #8f6a29;
    }
    .hero.video .btn.ghost {
      background: rgba(0,0,0,.4);
      color: #f5f0e6;
      border: 1px solid rgba(255,255,255,.25);
    }
    .hero.video .hero-footnote { margin-top: 6px; opacity: .85; }

    /* Gallery grid */
    .section .gallery {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      max-width: 1100px;
      margin: 0 auto;
    }
    .gallery img {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      border-radius: 12px;
      border: 1px solid #e7e0d1;
      background: #fff;
      box-shadow: 0 14px 38px rgba(0,0,0,0.06);
    }

    /* Sponsor placeholders look tidy even before data */
    .sponsor-grid:empty::before {
      content: "";
      display: block;
      background:
        url('images/placeholders/ph-sponsor-3x1.svg') no-repeat center/contain,
        url('images/placeholders/ph-sponsor-3x1.svg') no-repeat left/contain,
        url('images/placeholders/ph-sponsor-3x1.svg') no-repeat right/contain;
      height: 90px;
      opacity: .65;
      filter: saturate(.7);
      border: 1px dashed #e7e0d1;
      border-radius: 12px;
    }

    /* Featured players grid + cards (homepage) */
    .players-grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      align-items: stretch;
    }
    .player-card {
      background: #fff;
      border: 1px solid #e7e0d1;
      border-radius: 16px;
      padding: 10px 12px;
      display: flex;
      gap: 12px;
      align-items: center;
      box-shadow: 0 12px 32px rgba(0,0,0,.06);
    }
    .player-photo-wrap {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
      background: #f5f0e6;
      border: 1px solid #e7e0d1;
      display: grid;
      place-items: center;
      font-weight: 700;
      color: #244f3c;
      text-transform: uppercase;
    }
    .player-photo-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .player-body {
      flex: 1;
      min-width: 0;
    }
    .player-name {
      margin: 0 0 4px;
      font-size: 1rem;
      font-weight: 800;
      letter-spacing: .01em;
    }
    .player-meta {
      margin: 0;
      font-size: .85rem;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }
    .player-meta .badge {
      border-radius: 999px;
      padding: .15rem .5rem;
      border: 1px solid #d9d2c4;
      background: #fdfaf4;
    }
    .badge.team.oz { border-color: rgba(46,204,113,.4); }
    .badge.team.va { border-color: rgba(52,152,219,.4); }
  </style>
</head>
<body id="top">
  <!-- SHARED TOP BAR -->
  <div id="siteHeader"></div>
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("siteHeader").innerHTML = html;
        // Highlight current page (safe on GitHub Pages)
        const here = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
        document.querySelectorAll('.nav a').forEach(a=>{
          const t = (a.getAttribute('href')||'').split('#')[0]||'index.html';
          if (t.toLowerCase()===here) a.setAttribute('aria-current','page');
        });

        // Boot the small header score widget if available
        if (window.initTeamScoreWidget) {
          window.initTeamScoreWidget();
        }
      });
  </script>

  <!-- HERO (video background enabled) -->
  <section class="hero video" id="top-hero">
    <video class="hero-video" autoplay muted playsinline loop poster="images/placeholders/ph-hero-1440x810.svg">
      <source src="media/placeholder-vid.mp4" type="video/mp4">
      <source src="media/placeholder-vid.webm" type="video/webm">
      Your browser does not support the video tag.
    </video>

    <div class="hero-overlay">
      <p class="tagline">Ozark Invitational • Diamond Hills Country Club</p>
      <h1>Two-Day Ryder Cup Style Golf Tournament</h1>
      <p class="lead">
        Diamond Hills Country Club • Diamond City, Arkansas.
        Friendly competition, bragging rights, and a traveling trophy that MUST stay in the winner’s house.
      </p>

      <div class="hero-pills">
        <div class="pill">
          <span class="pill-label">Dates</span>
          <span class="pill-value">May 23–24</span>
        </div>
        <div class="pill">
          <span class="pill-label">Venue</span>
          <span class="pill-value">DHCC – Diamond City, AR</span>
        </div>
        <div class="pill">
          <span class="pill-label">Entry</span>
          <span class="pill-value">$150 (lunch incl.)</span>
        </div>
      </div>

      <div class="hero-actions">
        <a href="#signup" class="btn primary">Reserve my spot</a>
        <a href="#schedule" class="btn ghost">View format</a>
      </div>

      <p class="hero-footnote">
        Spots limited to a set field • Captains announced closer to the event.
      </p>
    </div>
  </section>

  <main>
    <!-- EVENT DETAILS -->
    <section id="about" class="section section-tight">
      <div class="section-head center">
        <h2>About the Tournament</h2>
        <p>One weekend every year where everybody shows up, plays, and has a story to tell until next spring.</p>
      </div>

      <div class="info-row">
        <article class="info-card">
          <h3>Date &amp; Location</h3>
          <p class="muted">Locked, not tentative.</p>
          <ul>
            <li><strong>Saturday – Rounds 1–2</strong></li>
            <li><strong>Sunday – Rounds 3–4</strong></li>
            <li>Diamond Hills Country Club, Diamond City, AR</li>
          </ul>
        </article>

        <article class="info-card">
          <h3>Format</h3>
          <p class="muted">Ryder Cup inspired.</p>
          <ul>
            <li>2 teams: Team Ozark vs Team Valley</li>
            <li>Pairings announced morning-of</li>
            <li>Each match = 1 point for team</li>
            <li>Most points wins the Invitational</li>
          </ul>
        </article>

        <article class="info-card">
          <h3>Cost &amp; Inclusions</h3>
          <p class="muted">Straightforward pricing.</p>
          <ul>
            <li><strong>$150 per player</strong></li>
            <li>Greens fees + cart both days</li>
            <li>Lunch (Day 1)</li>
            <li>Prizes &amp; traveling trophy</li>
          </ul>
        </article>
      </div>
    </section>

    <!-- FEATURED PLAYERS -->
    <section id="featured" class="section section-tight">
      <div class="section-head center">
        <h2>Featured Players</h2>
        <p>A rotating snapshot of the field – reload to see different faces.</p>
      </div>

      <div class="players-grid" id="featuredGrid">
        <p class="muted">Loading players…</p>
      </div>
    </section>

    <!-- SCHEDULE -->
    <section id="schedule" class="section section-alt pro-schedule">
      <div class="section-head center">
        <h2>Weekend Schedule</h2>
        <p>Tap a day to see what we’re playing.</p>
      </div>

      <div class="tabs tabs-centered">
        <button class="tab-btn active" data-day="day1">Day 1 • Saturday</button>
        <button class="tab-btn" data-day="day2">Day 2 • Sunday</button>
      </div>

      <div class="schedule-cols">
        <div class="schedule-day active" id="day1">
          <div class="sched-card">
            <span class="sched-time">8:00 AM</span>
            <h3>Check-in &amp; Range</h3>
            <p>Grab carts, hit balls, team photos.</p>
          </div>
          <div class="sched-card">
            <span class="sched-time">9:00 AM</span>
            <h3>Round 1 – Best Ball (Front 9)</h3>
            <p>Each plays own ball, best score counts to team.</p>
          </div>
          <div class="sched-card">
            <span class="sched-time">10:30 AM</span>
            <h3>Round 1 – 2-Man Scramble (Back 9)</h3>
            <p>Pick best shot every stroke. Low scores win.</p>
          </div>
          <div class="sched-card highlight">
            <span class="sched-time">12:30 PM</span>
            <h3>Lunch &amp; Day 1 Scoring</h3>
            <p>Included. Scores posted to main board.</p>
          </div>
        </div>

        <div class="schedule-day" id="day2" hidden>
          <div class="sched-card">
            <span class="sched-time">8:30 AM</span>
            <h3>Warm-up &amp; Singles Pairings</h3>
            <p>Captains finalize Day 2 rotation.</p>
          </div>
          <div class="sched-card">
            <span class="sched-time">9:30 AM</span>
            <h3>Round 2 – Alternate Shot (Front 9)</h3>
            <p>True team golf. Alternate every shot.</p>
          </div>
          <div class="sched-card">
            <span class="sched-time">11:00 AM</span>
            <h3>Round 2 – Singles (Back 9)</h3>
            <p>1v1 matches, each worth 1 point toward team total.</p>
          </div>
          <div class="sched-card highlight">
            <span class="sched-time">1:00 PM</span>
            <h3>Trophy &amp; Photos</h3>
            <p>Winning team name engraved, family photo, wrap-up.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ / Quick answers -->
    <section id="faq" class="section section-tight">
      <div class="section-head center">
        <h2>Quick Answers</h2>
        <p>Stuff people usually text about the week before.</p>
      </div>

      <div class="info-row">
        <article class="info-card">
          <h3>Who can play?</h3>
          <p>
            Any golfer who wants in on a fun, competitive two-day event at Diamond Hills is welcome.
            The Ozark Invitational is open to adults of all skill levels — friends, guests, and
            regulars at the course. If you enjoy team formats, match play, and a bit of friendly
            rivalry, you’ll fit right in.
          </p>
        </article>

        <article class="info-card">
          <h3>What skill level is this for?</h3>
          <p>
            All skill levels. We use handicaps or average scores to balance the teams and pairings
            so nobody gets steamrolled. If you don’t keep a handicap, give us your honest average
            18-hole score.
          </p>
        </article>

        <article class="info-card">
          <h3>How does scoring work?</h3>
          <p>
            Each match is worth 1 point for your team. Halved matches are worth 0.5 points to each
            side. We use net scores where it makes sense so higher handicaps still matter. Final
            total points wins the Invitational.
          </p>
        </article>
      </div>
    </section>

    <!-- GALLERY (carousel + zoomable lightbox) -->
    <section id="gallery" class="section">
      <div class="section-head center">
        <h2>Moments (Coming Soon)</h2>
        <p>We’ll swap these placeholders with real photos after the event.</p>
      </div>

      <div class="gallery-wrap">
        <button class="gbtn prev" aria-label="Previous photos" id="galPrev">‹</button>
        <div id="galleryRail" class="gallery-rail" aria-live="polite" tabindex="0"></div>
        <button class="gbtn next" aria-label="Next photos" id="galNext">›</button>
      </div>

      <noscript><p>Please enable JavaScript to view the gallery.</p></noscript>
    </section>

    <!-- LIGHTBOX (zoom/pan) -->
    <dialog id="lightbox" class="lightbox">
      <button class="lb-close" id="lbClose" aria-label="Close">✕</button>
      <img id="lbImg" alt="Gallery image" />
      <div class="lb-controls">
        <button id="lbMinus" class="btn">−</button>
        <button id="lbReset" class="btn">Reset</button>
        <button id="lbPlus" class="btn">+</button>
      </div>
    </dialog>

    <!-- SPONSORS -->
    <section id="sponsors" class="section section-tight">
      <div class="section-head center">
        <h2>Sponsors</h2>
        <p>These folks help cover lunch, prizes, and course costs.</p>
      </div>
      <div class="sponsor-grid" id="sponsorGrid"></div>
      <p class="sponsor-cta">
        Want to sponsor a hole or prize?
        <a href="mailto:nicholasbrownworship@gmail.com">Email Nick</a>
      </p>
    </section>

    <!-- TEAM / FIELD SUMMARY -->
    <section id="field" class="section section-tight">
      <div class="section-head center">
        <h2>Who&rsquo;s Playing So Far</h2>
        <p>Live counts from seeded players and online signups.</p>
      </div>

      <div id="teamSummary" class="team-summary">
        <p class="muted">Loading current field&hellip;</p>
      </div>
    </section>

    <!-- SIGN UP -->
    <section class="section section-tight section-alt" id="signup">
      <div class="signup-wrap">
        <div class="signup-card">
          <div class="card-head">
            <h3>Sign Up</h3>
            <span class="muted">Join the Ozark Invitational</span>
          </div>

          <!-- No action/method; handled by script.js -->
          <form id="signupForm" novalidate>
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
              <input type="text" name="_gotcha" tabindex="-1" autocomplete="off" />
            </div>
            <input type="hidden" name="_subject" value="New Ozark Invitational signup" />
            <input type="hidden" name="_redirect" value="false" />

            <div class="form-row">
              <div class="full">
                <label for="name">Full Name</label>
                <input type="text" id="name" name="name" placeholder="Full Name" required />
              </div>
            </div>

            <div class="form-row">
              <div class="full">
                <label for="nickname">Nickname (optional)</label>
                <input type="text" id="nickname" name="nickname" placeholder="e.g., Long Ball" />
              </div>
            </div>

            <div class="form-row">
              <div class="full">
                <label for="handicap">Handicap (or average score)</label>
                <input type="number" id="handicap" name="handicap" placeholder="Handicap" required />
              </div>
            </div>

            <div class="full">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" placeholder="Email" required />
            </div>

            <div class="full">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" name="phone" placeholder="(555) 555-5555" required />
            </div>

            <div class="form-row">
              <div class="full">
                <label for="signupTeam">Team</label>
                <select id="signupTeam" name="team" required>
                  <option value="" disabled selected>Select a team…</option>
                  <option value="ozark">Team Ozark</option>
                  <option value="valley">Team Valley</option>
                </select>
              </div>
            </div>

            <div class="full">
              <label for="photo">Player Photo (optional)</label>
              <input type="file" id="photo" name="photo" accept="image/*" capture="environment" />
            </div>

            <div class="full">
              <label for="notes">Notes</label>
              <textarea id="notes" name="notes" placeholder="Notes or comments" required></textarea>
            </div>

            <div class="actions">
              <button class="btn" type="submit">Submit</button>
              <span id="formMsg" aria-live="polite"></span>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <!-- Sticky signup bar (NEW) -->
  <div id="signupCtaBar" class="signup-cta-bar" hidden>
    <div class="signup-cta-inner">
      <span class="signup-cta-text">
        Ready to play the Ozark Invitational?
      </span>
      <a href="#signup" class="btn primary signup-cta-btn">
        Reserve my spot
      </a>
    </div>
  </div>

  <footer class="footer">
    <p>Ozark Invitational &copy; 2026 • Hosted at Diamond Hills Country Club.</p>
  </footer>

  <!-- Tabs helper (safe if script.js also handles tabs) -->
  <script>
    (function () {
      const buttons = Array.from(document.querySelectorAll('.tab-btn'));
      const days = Array.from(document.querySelectorAll('.schedule-day'));
      if (!buttons.length || !days.length) return;
      function show(id) {
        days.forEach(d => {
          const active = d.id === id;
          d.classList.toggle('active', active);
          d.toggleAttribute('hidden', !active);
        });
        buttons.forEach(b => b.classList.toggle('active', b.dataset.day === id));
      }
      buttons.forEach(btn => btn.addEventListener('click', () => show(btn.dataset.day)));
    })();
  </script>

  <!-- Sponsor placeholders if empty -->
  <script>
    (function () {
      const grid = document.getElementById('sponsorGrid');
      if (!grid || grid.children.length) return;
      const mk = () => {
        const img = document.createElement('img');
        img.alt = "Sponsor placeholder";
        img.loading = "lazy";
        img.decoding = "async";
        img.src = "images/placeholders/ph-sponsor-3x1.svg";
        return img;
      };
      for (let i = 0; i < 8; i++) {
        const wrap = document.createElement('div');
        wrap.className = 'sponsor';
        wrap.appendChild(mk());
        grid.appendChild(wrap);
      }
    })();
  </script>

  <!-- Gallery carousel + lightbox -->
  <script>
    (function(){
      /* ---------- Config ---------- */
      const COUNT = 6;
      const DIRS = ["images/gallery/"];
      const NAME_PATTERNS = [
        i => `placeholder${i}`,
        i => `placeholder-${i}`,
        i => `placeholder ${i}`,
        i => `placeholder (${i})`
      ];
      const EXTS = ["webp","jpg","jpeg","png","svg","WEBP","JPG","JPEG","PNG","SVG"];

      const rail = document.getElementById("galleryRail");
      if (!rail) return;

      /* ---------- Build candidate URLs ---------- */
      function candidatesForIndex(i){
        if (Array.isArray(window.__GALLERY_FILES__) && window.__GALLERY_FILES__[i-1]) {
          return [window.__GALLERY_FILES__[i-1]];
        }
        const urls = [];
        for (const dir of DIRS) {
          for (const pat of NAME_PATTERNS) {
            const base = pat(i);
            for (const ext of EXTS) urls.push(`${dir}${base}.${ext}`);
          }
        }
        return urls;
      }

      function setNextSrc(img, urls, idx){
        if (idx >= urls.length) {
          img.src = "images/placeholders/ph-gallery-4x3.svg";
          img.onerror = null;
          return;
        }
        const url = urls[idx] + (urls[idx].includes("?") ? "" : `?v=${Date.now()}`);
        img.dataset.try = urls[idx];
        img.src = url;
      }

      /* ---------- Render carousel items ---------- */
      const items = [];
      for (let i = 1; i <= COUNT; i++){
        const wrap = document.createElement("button");
        wrap.type = "button";
        wrap.className = "gitem";
        wrap.setAttribute("aria-label", `Open image ${i} larger`);
        const img = document.createElement("img");
        img.alt = `gallery image ${i}`;
        img.loading = "lazy"; img.decoding = "async";

        const tries = candidatesForIndex(i);
        let k = 0;
        img.onerror = () => { k++; setNextSrc(img, tries, k); };
        setNextSrc(img, tries, k);

        wrap.appendChild(img);
        rail.appendChild(wrap);
        items.push({wrap, img});
      }

      /* ---------- Carousel nav ---------- */
      const prev = document.getElementById("galPrev");
      const next = document.getElementById("galNext");

      function scrollByAmount(dir){
        const amt = Math.max(rail.clientWidth * 0.9, 300) * dir;
        rail.scrollBy({left: amt, behavior: "smooth"});
      }
      prev.addEventListener("click", ()=> scrollByAmount(-1));
      next.addEventListener("click", ()=> scrollByAmount( 1));

      rail.addEventListener("keydown", (e)=>{
        if (e.key === "ArrowLeft") { e.preventDefault(); scrollByAmount(-1); }
        if (e.key === "ArrowRight"){ e.preventDefault(); scrollByAmount( 1); }
      });

      /* ---------- Lightbox (zoom & pan) ---------- */
      const dlg = document.getElementById("lightbox");
      const lbImg = document.getElementById("lbImg");
      const lbClose = document.getElementById("lbClose");
      const lbPlus  = document.getElementById("lbPlus");
      const lbMinus = document.getElementById("lbMinus");
      const lbReset = document.getElementById("lbReset");

      let currentIndex = 0;
      let scale = 1, tx = 0, ty = 0;

      function applyTransform(){
        lbImg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
      }
      function resetTransform(){ scale = 1; tx = 0; ty = 0; applyTransform(); }

      function openLightbox(idx){
        currentIndex = idx;
        lbImg.src = items[idx].img.src;
        resetTransform();
        dlg.showModal();
      }
      function closeLightbox(){ dlg.close(); }

      items.forEach((it, idx)=>{
        it.wrap.addEventListener("click", ()=> openLightbox(idx));
      });

      lbClose.addEventListener("click", closeLightbox);
      lbReset.addEventListener("click", resetTransform);
      lbPlus .addEventListener("click", ()=>{ scale = Math.min(4, scale + 0.2); applyTransform(); });
      lbMinus.addEventListener("click", ()=>{ scale = Math.max(1, scale - 0.2); applyTransform(); });

      dlg.addEventListener("wheel", (e)=>{
        e.preventDefault();
        const delta = -Math.sign(e.deltaY);
        const prevScale = scale;
        scale = Math.min(4, Math.max(1, scale + delta * 0.15));
        const rect = lbImg.getBoundingClientRect();
        const cx = e.clientX - rect.left - rect.width/2;
        const cy = e.clientY - rect.top  - rect.height/2;
        tx = (tx - cx) * (scale/prevScale) + cx;
        ty = (ty - cy) * (scale/prevScale) + cy;
        applyTransform();
      }, {passive:false});

      let dragging = false, sx=0, sy=0, stx=0, sty=0;
      lbImg.addEventListener("mousedown", (e)=>{
        dragging = true; sx = e.clientX; sy = e.clientY; stx = tx; sty = ty; e.preventDefault();
      });
      window.addEventListener("mousemove", (e)=>{
        if (!dragging) return;
        tx = stx + (e.clientX - sx);
        ty = sty + (e.clientY - sy);
        applyTransform();
      });
      window.addEventListener("mouseup", ()=> dragging = false);

      dlg.addEventListener("keydown", (e)=>{
        if (e.key === "Escape") closeLightbox();
        if (e.key === "ArrowRight") {
          currentIndex = (currentIndex+1) % items.length;
          lbImg.src = items[currentIndex].img.src;
          resetTransform();
        }
        if (e.key === "ArrowLeft")  {
          currentIndex = (currentIndex-1+items.length) % items.length;
          lbImg.src = items[currentIndex].img.src;
          resetTransform();
        }
      });

      dlg.addEventListener("click", (e)=>{
        const r = dlg.getBoundingClientRect();
        if (e.clientX < r.left || e.clientX > r.right || e.clientY < r.top || e.clientY > r.bottom) closeLightbox();
      });
    })();
  </script>

  <!-- Featured players renderer (same photo logic style as players.html) -->
  <script>
    (function(){
      const grid = document.getElementById('featuredGrid');
      if (!grid) return;

      const SHARED_KEY = "ozarkShared_v1";
      const SIGNUPS_ROSTER_KEY = "ozarkSignupsRoster_v1"; // fallback; main data still from shared/state

      const PHOTO_BASE = "images/players/";
      const PHOTO_EXTS = ["png","jpg","jpeg","webp"];

      function loadSharedPlayers(){
        try{
          const raw = localStorage.getItem(SHARED_KEY);
          if (!raw) return [];
          const snap = JSON.parse(raw);
          if (snap && Array.isArray(snap.players)) return snap.players;
        }catch{}
        return [];
      }

      function loadSignups(){
        try{
          const raw = localStorage.getItem(SIGNUPS_ROSTER_KEY);
          if (!raw) return [];
          const arr = JSON.parse(raw);
          return Array.isArray(arr) ? arr : [];
        }catch{}
        return [];
      }

      function firstLastFrom(p){
        const first = (p.firstName || p.FirstName || p.first || "").trim();
        const last  = (p.lastName  || p.LastName  || p.last  || "").trim();
        return { first, last };
      }

      function normalizeTeam(raw){
        const t = (raw || "").toString().toLowerCase();
        if (t.includes("val")) return "valley";
        if (t.includes("oz"))  return "ozark";
        return "";
      }

      function initialsOf(p){
        const { first, last } = firstLastFrom(p);
        const fi = first ? first[0] : "";
        const li = last  ? last[0]  : "";
        const both = (fi + li).trim();
        return (both || "OI").toUpperCase();
      }

      function normalizePhotoValue(v){
        if (!v) return "";
        return String(v)
          .trim()
          .replace(/\\/g,"/")
          .replace(/^\/+/, "")
          .replace(/^\.\//,"");
      }

      function slugifyName(p){
        const { first, last } = firstLastFrom(p);
        const norm = s => String(s||"")
          .trim()
          .toLowerCase()
          .replace(/[^a-z0-9]+/g,"-")
          .replace(/^-+|-+$/g,"");
        const f = norm(first);
        const l = norm(last);
        return [f,l].filter(Boolean).join("-");
      }

      function candidatePhotoURLs(p){
        // Prefer explicit CSV/photo fields first
        const explicit = normalizePhotoValue(
          p.photo || p.Photo ||
          p.photourl || p.photoURL || p.PhotoURL ||
          p.image || p.Image || ""
        );
        if (explicit){
          if (/^https?:\/\//i.test(explicit)) return [explicit];          // absolute URL
          if (explicit.includes("/")) return [explicit];                  // relative path already has folders
          return [PHOTO_BASE.replace(/\/+$/,"") + "/" + explicit];        // bare filename
        }
        // Else slug from first+last with common extensions
        const slug = slugifyName(p);
        if (!slug) return [];
        return PHOTO_EXTS.map(ext => `${PHOTO_BASE}${slug}.${ext}`);
      }

      function loadImage(url){
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => resolve(url);
          img.onerror = reject;
          img.src = url;
        });
      }

      async function resolvePhotoURL(p){
        const candidates = candidatePhotoURLs(p);
        for (const url of candidates){
          try {
            await loadImage(url);
            return url;
          } catch(_){}
        }
        return "";
      }

      function getPlayers(){
        // 1) Prefer window.state.players if script.js built it
        if (window.state && Array.isArray(window.state.players) && window.state.players.length){
          return window.state.players;
        }
        // 2) Fallback: shared snapshot used by scoreboard/pairings
        const sharedPlayers = loadSharedPlayers();
        if (sharedPlayers.length) return sharedPlayers;

        // 3) Fallback: raw signups roster
        const signups = loadSignups();
        if (signups.length) return signups;

        return [];
      }

      function pickRandom(src, count){
        const copy = src.slice();
        const out = [];
        while (copy.length && out.length < count){
          const idx = Math.floor(Math.random() * copy.length);
          out.push(copy.splice(idx, 1)[0]);
        }
        return out;
      }

      function renderCard(p, idx){
        const { first, last } = firstLastFrom(p);

        const nicknameRaw = p.nickname || p.Nickname || p.nick || "";
        const nickClean = nicknameRaw.toString().trim();
        const nickname = nickClean ? ` “${nickClean}”` : "";

        const teamNorm = normalizeTeam(p.team || p.Team) || "ozark";
        const teamLabel = teamNorm === "valley" ? "Team Valley" : "Team Ozark";
        const teamClass = teamNorm === "valley" ? "va" : "oz";

        const hRaw = (
          p.handicap ?? p.Handicap ??
          p.hcp      ?? p.HCP      ??
          p.hi       ?? p.Hi       ??
          p.index    ?? p.Index    ?? ""
        );
        const hcapStr = hRaw !== null && hRaw !== undefined && String(hRaw).trim() !== ""
          ? String(hRaw).trim()
          : "";

        const fullName = (first + " " + last).trim();

        // Photo wrapper only; we hydrate with real image or initials later
        const avatarHtml = `
          <div class="player-photo-wrap" data-feature-index="${idx}">
            ${initialsOf(p)}
          </div>
        `;

        return `
          <article class="player-card" data-feature-index="${idx}">
            ${avatarHtml}
            <div class="player-body">
              <h3 class="player-name">${fullName}${nickname}</h3>
              <p class="player-meta">
                <span class="badge team ${teamClass}">${teamLabel}</span>
                ${hcapStr ? `<span class="badge">HCP ${hcapStr}</span>` : ""}
              </p>
            </div>
          </article>
        `;
      }

      async function hydrateFeaturedPhotos(picks){
        for (let i = 0; i < picks.length; i++){
          const p = picks[i];
          const wrap = grid.querySelector('.player-photo-wrap[data-feature-index="' + i + '"]');
          if (!wrap) continue;

          const url = await resolvePhotoURL(p);
          const { first, last } = firstLastFrom(p);
          const fullName = (first + " " + last).trim();

          if (url){
            wrap.innerHTML = "";
            const img = document.createElement("img");
            img.src = url;
            img.alt = fullName || "Player photo";
            img.loading = "lazy";
            img.decoding = "async";
            wrap.appendChild(img);
          } else {
            // keep initials fallback already in wrap
            wrap.textContent = initialsOf(p);
          }
        }
      }

      function renderFeatured(){
        const players = getPlayers();
        if (!players.length){
          grid.innerHTML = `<p class="muted">Players will appear here once the field is loaded.</p>`;
          return;
        }
        const picks = pickRandom(players, 4);
        grid.innerHTML = picks.map((p, idx) => renderCard(p, idx)).join("");
        // hydrate photos asynchronously
        hydrateFeaturedPhotos(picks);
      }

      // Wait until after everything (including script.js) is loaded
      window.addEventListener("load", renderFeatured);
    })();
  </script>

  <!-- Service worker -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("./sw.js")
          .catch(err => console.error("SW registration failed:", err));
      });
    }
  </script>
</body>
</html>
